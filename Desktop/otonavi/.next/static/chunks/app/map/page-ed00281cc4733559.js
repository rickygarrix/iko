(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[823],{561:(e,t,n)=>{Promise.resolve().then(n.bind(n,9722))},6855:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});let s=(0,n(5974).UU)("https://bqexmwjcmtyypzucndrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZXhtd2pjbXR5eXB6dWNuZHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MjA5NjQsImV4cCI6MjA1NjE5Njk2NH0.LgmwOIcW4UsTqwigP7BgXBrQmtSah362_dsWqjecTQQ")},9722:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var s=n(5155),r=n(2115),l=n(9047),i=n(6855),o=n(1455),a=n.n(o);n(1550);var c=n(4084),p=n.n(c);a().extend(p());let u=e=>e.replace("Sunday","日曜日").replace("Monday","月曜日").replace("Tuesday","火曜日").replace("Wednesday","水曜日").replace("Thursday","木曜日").replace("Friday","金曜日").replace("Saturday","土曜日").replace("曜日",""),d=e=>{var t,n,s,r;if(!e)return{displayText:"営業時間情報なし",isOpen:!1};let l=a()().locale("ja"),i=l;6>l.hour()&&(i=l.subtract(1,"day"));let o=u(i.format("dddd")),c=u(i.add(1,"day").format("dddd")),p={};e.split("\n").forEach(e=>{let t=e.match(/^(.+?曜)\s*(.+)$/);if(t&&t[1]&&t[2]){let e=t[1].trim(),n=t[2].trim();if("休み"===n)p[e]=[];else{let t=n.split(", ");p[e]=t.map(e=>{let[t,n]=e.split("〜").map(e=>e.trim());return{open:t,close:n}})}}});let d=Object.keys(p).find(e=>e.startsWith(o));if(!d||!p.hasOwnProperty(d)||!Array.isArray(p[d])||(null===(t=p[d])||void 0===t?void 0:t.length)===0){let e=Object.keys(p).find(e=>e.startsWith(c));return e&&p[e].length>0?{displayText:"本日休業",isOpen:!1,nextOpening:"次の営業: ".concat(e," ").concat(null===(n=p[e][0])||void 0===n?void 0:n.open," から")}:{displayText:"本日休業",isOpen:!1}}let g=p[d]||[];if(!g.length)return{displayText:"営業時間情報なし",isOpen:!1};let m=!1,h="";for(let e of g){let t=parseInt(e.open.split(":")[0],10),n=parseInt(e.open.split(":")[1],10),s=parseInt(e.close.split(":")[0],10),r=parseInt(e.close.split(":")[1],10),o=i.set("hour",t).set("minute",n),a=i.set("hour",s).set("minute",r);if(s>=24&&(s-=24,a=i.add(1,"day").set("hour",s).set("minute",r)),l.isBetween(o,a,null,"[)"))return m=!0,{displayText:h="本日 ".concat(a.format("HH:mm")," まで営業"),isOpen:m,nextOpening:h}}if(!m){if(6>l.hour())return{displayText:"営業時間外",isOpen:!1,nextOpening:"6時の更新をお待ちください"};let e=g.filter(e=>a()("".concat(i.format("YYYY-MM-DD")," ").concat(e.open)).isAfter(i));if(e.length>0)h="次の営業: 本日 ".concat(null===(s=e[0])||void 0===s?void 0:s.open," から");else{let e=Object.keys(p).find(e=>e.startsWith(c));e&&p[e].length>0&&(h="次の営業: ".concat(e," ").concat(null===(r=p[e][0])||void 0===r?void 0:r.open," から"))}}return h.startsWith("次の営業: 本日")&&(h=h.replace("次の営業: 本日","本日")),{displayText:m?h:"営業時間外",isOpen:m,nextOpening:h||"6時の更新をお待ちください"}};var g=n(6046);let m={width:"100%",height:"82vh"},h=["Jazz","House","Techno","EDM"],f=(e,t,n,s)=>{let r=(n-e)*Math.PI/180,l=(s-t)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371};function y(){let e=(0,g.useRouter)(),t=(0,g.useSearchParams)().toString(),[n,o]=(0,r.useState)([]),[a,c]=(0,r.useState)(null),[p,u]=(0,r.useState)({lat:35.6895,lng:139.6917}),[y,S]=(0,r.useState)(!0),[x,O]=(0,r.useState)(!1),[b,I]=(0,r.useState)([]),[C,N]=(0,r.useState)(13),[j,v]=(0,r.useState)(null),J=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=sessionStorage.getItem("mapCenter"),t=sessionStorage.getItem("mapZoom"),n=sessionStorage.getItem("filters"),s=sessionStorage.getItem("locations"),r=sessionStorage.getItem("selectedStore");if(e){let t=JSON.parse(e);(t.lat!==p.lat||t.lng!==p.lng)&&u(t)}if(null!==t){let e=JSON.parse(t);e!==C&&N(e)}if(n){let{showOnlyOpen:e,selectedGenres:t}=JSON.parse(n);e!==x&&O(e),JSON.stringify(t)!==JSON.stringify(b)&&I(t)}s?o(JSON.parse(s)):k(p.lat,p.lng,x,b).then(e=>{o(e),sessionStorage.setItem("locations",JSON.stringify(e))}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:n}=e.coords;c({lat:t,lng:n}),(t!==p.lat||n!==p.lng)&&(u({lat:t,lng:n}),sessionStorage.setItem("mapCenter",JSON.stringify({lat:t,lng:n})))},e=>console.error("\uD83D\uDCCD 現在地取得エラー:",e));let l=()=>{S(!0)};return r&&v(JSON.parse(r)),document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[x,b]);let k=async(e,t,n,s)=>{if(!e||!t)return[];let{data:r,error:l}=await i.N.from("stores").select("id, name, latitude, longitude, genre, area, image_url, opening_hours");return l?(console.error("\uD83D\uDD25 Supabase Error:",l.message),[]):r?r.map(e=>{let{isOpen:t,displayText:n,nextOpening:s}=d(e.opening_hours);return{id:e.id,name:e.name,lat:Number(e.latitude),lng:Number(e.longitude),genre:e.genre,area:e.area,image_url:e.image_url||"/default-image.jpg",opening_hours:e.opening_hours||"営業時間情報なし",isOpen:null!=t&&t,displayText:n,nextOpening:null!=s?s:"次の営業情報なし"}}).filter(r=>{let l=5>=f(e,t,r.lat,r.lng),i=!n||r.isOpen,o=!(s.length>0)||s.includes(r.genre);return l&&i&&o}):[]},D=e=>{if(J.current){var t,n;let s=J.current,r=(null===(t=s.getCenter())||void 0===t?void 0:t.lat())||e.lat,l=(null===(n=s.getCenter())||void 0===n?void 0:n.lng())||e.lng,i=e.lat,o=e.lng,a=0,c=()=>{let t=++a/30,n=t<.5?2*t*t:-1+(4-2*t)*t;s.panTo({lat:r+(i-r)*n,lng:l+(o-l)*n}),a<30?requestAnimationFrame(c):(sessionStorage.setItem("mapCenter",JSON.stringify({lat:i,lng:o})),sessionStorage.setItem("mapZoom",JSON.stringify(s.getZoom())),sessionStorage.setItem("selectedStore",JSON.stringify(e)),v(e))};requestAnimationFrame(c)}},M=async()=>{if(J.current){let e=J.current.getCenter(),t=J.current.getZoom()||13;if(!e)return;let n=await k(e.lat(),e.lng(),x,b);sessionStorage.setItem("mapCenter",JSON.stringify({lat:e.lat(),lng:e.lng()})),sessionStorage.setItem("mapZoom",JSON.stringify(t)),sessionStorage.setItem("filters",JSON.stringify({showOnlyOpen:x,selectedGenres:b})),sessionStorage.setItem("locations",JSON.stringify(n)),u({lat:e.lat(),lng:e.lng()}),N(t),o(n),S(!1)}},w=e=>{let t=b.includes(e)?b.filter(t=>t!==e):[...b,e];I(t),sessionStorage.setItem("filters",JSON.stringify({showOnlyOpen:x,selectedGenres:t})),k(p.lat,p.lng,x,t).then(e=>{o(e),sessionStorage.setItem("locations",JSON.stringify(e))})};return(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsxs)(l.u6,{mapContainerStyle:m,center:p,zoom:C,options:{gestureHandling:"greedy",fullscreenControl:!1,disableDefaultUI:!0,mapTypeControl:!1,streetViewControl:!1,zoomControl:!1},onLoad:e=>{J.current=e},onDragEnd:()=>{if(J.current){let e=J.current.getCenter();e&&(u({lat:e.lat(),lng:e.lng()}),S(!0))}},onZoomChanged:()=>{J.current&&(N(J.current.getZoom()||13),S(!0))},children:[a&&(0,s.jsx)(l.jl,{center:a,radius:50,options:{strokeColor:"#007bff",fillColor:"#007bff",fillOpacity:.35}}),n.map(e=>(0,s.jsx)(l.pH,{position:{lat:e.lat,lng:e.lng},label:{text:e.name,color:"black",fontSize:"12px",fontWeight:"bold"},onClick:()=>D(e)},e.id))]}),(0,s.jsxs)("div",{style:{position:"absolute",top:20,left:20,backgroundColor:"#FFA500",padding:"10px",borderRadius:"10px",display:"flex",flexDirection:"column",gap:"5px"},children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{type:"checkbox",checked:x,onChange:()=>{let e=!x;O(e),sessionStorage.setItem("filters",JSON.stringify({showOnlyOpen:e,selectedGenres:b})),k(p.lat,p.lng,e,b).then(e=>{o(e),sessionStorage.setItem("locations",JSON.stringify(e))})}})," 営業中"]}),h.map(e=>(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{type:"checkbox",checked:b.includes(e),onChange:()=>w(e)})," ",e]},e))]}),y&&(0,s.jsx)("div",{style:{position:"absolute",top:20,left:"50%",transform:"translateX(-50%)",backgroundColor:"#FFA500",padding:"10px",borderRadius:"10px",zIndex:1e3},children:(0,s.jsx)("button",{onClick:M,children:"\uD83D\uDD0D このエリアで検索する"})}),j&&(0,s.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",backgroundColor:"white",padding:"16px",textAlign:"center",color:"black",fontSize:"16px",cursor:"pointer"},onClick:()=>e.push("/stores/".concat(j.id,"?prev=/map&").concat(t)),children:[(0,s.jsx)("h2",{children:j.name}),(0,s.jsxs)("p",{children:["\uD83C\uDFB5 ",j.genre," | \uD83D\uDCCD ",j.area]}),(0,s.jsx)("p",{style:{fontWeight:"bold",color:j.isOpen?"green":"red"},children:j.isOpen?"営業中":"営業時間外"}),(0,s.jsx)("p",{children:j.isOpen?j.displayText:j.nextOpening})]}),(0,s.jsx)("button",{onClick:()=>{a&&J.current&&(J.current.panTo(a),N(12),J.current.setZoom(13))},style:{position:"absolute",bottom:"140px",right:"20px",backgroundColor:"#FFA500",color:"white",padding:"10px 15px",borderRadius:"50%",border:"none",fontSize:"20px",cursor:"pointer",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3},title:"現在地に戻る",children:"\uD83D\uDCCD"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[84,145,441,517,358],()=>t(561)),_N_E=e.O()}]);